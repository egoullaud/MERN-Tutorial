David Gray MERN Tutorial

MongoDB
Express JS
React
Node JS

Create = POST
Read = GET
Update = PUT/PATCH
Delete = DELETE

Client interview - create markdown file checklist User Stories.md to make list of action items for project
preview with control-shift-v

open terminal hack - ctrl and `

build app THEN authetication last

put node_modules in gitignore - we don't need them on github

how to remove folder from github, not from local
git rm -r --cached myFolder

add following: nodemon and express and write the following scripts:
"start": "node server",
"dev" : "nodemon server"

Setting up Server!

1. create server.js file and import express and path and set up port for server to run:
   const express = require('express');
   const app = express();
   const path = require('path');
   const PORT = process.env.PORT || 3500;
2. Tell the app to "listen" so it runs server on port: this will go last on the server.js
   app.listen(PORT, () => console.log(`Server running on ${PORT}`));

3. Tell express where to find static files like html and css: (look in the public directory)
   app.use('/', express.static(path.join(\_\_dirname, '/public')));

4. Create Public folder and CSS folder to add some basic styles to app

5. Create Routes folder and root.js file - time to create a router for the app

6. import express, router, and path:
   const express = require('express');
   const router = express.Router();
   const path = require('path');

7. get function for router:  
    notes:
   "^" = at beginning of string only
   "$" = at end of the string only
"|" = or
"()?" = optional 
code is: 
router.get('^/$|/index(.html)?', (req,res) => {
   //response is to send the file from path (directoryName/../views/index.html)
   res.sendFile(path.join(\_\_dirname, '..','views','index.html'))
   });

8. export the module!
   module.exports = router

9. Create views folder and index.html file (shortcut is "!" will auto generate html)
   -import link to css sheet and change title, add h1

- app can find it because we set up a route to the static files

10. Create 404 html page inside views folder

11. back to server.js to handle any file not found _ add this after other routes, before the listen
    "_" = all
    everything that reaches this will get funneled through:
    app.all('\*', (req,res) => {
    // set status to error 404
    res.status(404)

//if request has "accepts header" in HTML then send views/404.html file
if(req.accepts('html')) {
res.sendFile(path.join(\_\_dirname, 'views', '404.html'))

//if request has "accepts header" in json then send message
} else if (req.accepts('json')) {
res.json({ message: '404 Not Found'})
} else {

//if request is type txt then send message
res.type('txt').send('404 not found')
}
})

\*Test in the browser
End of Lesson 1!

what is middleware?

- one or more functions put in the middle of a HTTP request that is received by the API
- can add additional functionality and preliminary request
  types:

a. Built-in
eg. express.static() and app.use(express.json())
b. Custom
c. 3rd Party

1. add built-in: Need to add JSON to our application so our server can parse incoming json
   app.use(express.json())
2. create logs folder - add to gitignore file
3. create middleware folder - new file called logger.js
4. install deps: npm i date-fns uuid
5. import format, version uuid, path, and promises
   const {format} = requre('date-fns')
   const {v4: uuid} = require('uuid')
   const fs = require('fs')
   const fsPromises = require('fs').promises
   const path=require('path')
6. create logEvents function
   const logEvents = async (message, logFileName) => {
   const dateTime = `${format(new Date(), 'yyyMMdd\tHH:mm:ss')}`
   const logItem = `${dateTime}\t${uuid()}\t${message}\n`

}
-template literal to format dates is from date-fns documentation
-uuid create specific id number for each log item

- "/n" creates new line

7. Let's ask the server to look for a logs folder with an if statement:
   if(!fs.existsSync(path.join(\_\_dirname, '..', 'logs')))

- if it doesnt exist, then we will create it with:
  await fsPromises.mkdir(path.join(\_\_dirname, '..', 'logs'))

8. once we find the directory, or we create it, let's add the file to it with:
   await fsPromises.appendFile(path.join(\_\_dirname, '..', 'logs',
   logFileName), logItem)
9. catch the errors with:
   catch(err) {
   console.log(err)
   }
10. write the actual middleware that will write the template literal into the log which is like a conventional text file:
    const logger= (req, res, next) =>{
    logEvents(`${req.method}\t${req.url}\t${req.headers.origin}`, 'reqLog.log')
    console.log(`${req.method} ${req.path}`)
    next()
    }
    \*recommends adding conditions to limit which requests are logged (only from other urls or something) otherwise the log will fill up fast.
11. add module exports
    module.exports = {logEvents, logger}

12. off to server.js to import logger with:
    const {logger} = require('./middleware/logger')
    add to app before other middleware: app.use(logger)
